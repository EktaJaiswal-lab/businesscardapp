{% extends "base.html" %}

{% block title %}{{ 'Edit' if card else 'New' }} Business Card - Business Card Generator{% endblock %}

{% block content %}
<div class="card">
    <div class="header">
        <h1>
            <i class="fas fa-{{ 'edit' if card else 'plus' }}"></i> 
            {{ 'Edit' if card else 'Create New' }} Business Card
        </h1>
        <p>{{ 'Update your business card information' if card else 'Fill in your business card details' }}</p>
    </div>

    <form method="POST" enctype="multipart/form-data">
        <div class="form-group">
            <label for="name">
                <i class="fas fa-user"></i> Full Name
            </label>
            <input type="text" id="name" name="name" class="form-control" required 
                   value="{{ card.name if card else '' }}" 
                   placeholder="Enter your full name">
        </div>

        <div class="form-group">
            <label for="designation">
                <i class="fas fa-briefcase"></i> Job Title
            </label>
            <input type="text" id="designation" name="designation" class="form-control" required 
                   value="{{ card.designation if card else '' }}" 
                   placeholder="e.g., Software Engineer, Marketing Manager">
        </div>

        <div class="form-group">
            <label for="company">
                <i class="fas fa-building"></i> Company
            </label>
            <input type="text" id="company" name="company" class="form-control" required 
                   value="{{ card.company if card else '' }}" 
                   placeholder="Enter your company name">
        </div>

        <div class="form-group">
            <label for="mobile">
                <i class="fas fa-phone"></i> Mobile Number
            </label>
            <input type="tel" id="mobile" name="mobile" class="form-control" required 
                   value="{{ card.mobile if card else '' }}" 
                   placeholder="Enter your mobile number">
        </div>

        <div class="form-group">
            <label for="email">
                <i class="fas fa-envelope"></i> Email Address
            </label>
            <input type="email" id="email" name="email" class="form-control" required 
                   value="{{ card.email if card else '' }}" 
                   placeholder="Enter your email address">
        </div>

        <div class="form-group">
            <label for="logo">
                <i class="fas fa-image"></i> Company Logo
            </label>
            <div class="file-input-wrapper" id="logo-upload-wrapper" {% if card and card.logo %}style="display:none;"{% endif %}>
                <input type="file" id="logo" name="logo" class="file-input" accept="image/*">
                <label for="logo" class="file-input-label">
                    <i class="fas fa-cloud-upload-alt"></i>
                    {{ 'Change Logo' if card and card.logo else 'Choose Logo File' }}
                </label>
            </div>
            <div id="logo-preview-container" style="position: relative; display: {% if card and card.logo %}inline-block{% else %}none{% endif %}; margin-top: 10px;">
                {% if card and card.logo %}
                <img id="logo-preview-img" src="{{ card.logo }}" alt="Current Logo" style="display: block; max-width: 120px; max-height: 120px;">
                <span id="remove-logo-btn"
                      style="position: absolute; top: 0; right: 0; background: #fff; border: 2px solid #e53e3e; color: #e53e3e; font-size: 32px; cursor: pointer; border-radius: 50%; width: 36px; height: 36px; line-height: 32px; text-align: center; display: flex; align-items: center; justify-content: center; z-index: 9999;">&times;</span>
                {% endif %}
            </div>
        </div>
        <script>
        document.addEventListener('DOMContentLoaded', function() {
            var fileInput = document.getElementById('logo');
            var logoUploadWrapper = document.getElementById('logo-upload-wrapper');
            var logoPreviewContainer = document.getElementById('logo-preview-container');

            function addRemoveBtnListener() {
                var removeBtn = document.getElementById('remove-logo-btn');
                if (removeBtn) {
                    removeBtn.onclick = function() {
                        // Remove the preview image if it exists
                        var img = document.getElementById('logo-preview-img');
                        if (img) img.remove();
                        logoPreviewContainer.innerHTML = '';
                        logoPreviewContainer.style.display = 'none';
                        logoUploadWrapper.style.display = 'block';
                        fileInput.value = '';
                    };
                }
            }
            addRemoveBtnListener();

            // Show preview and hide upload button on file select (for new uploads)
            if (fileInput) {
                fileInput.addEventListener('change', function(event) {
                    if (fileInput.files && fileInput.files[0]) {
                        var reader = new FileReader();
                        reader.onload = function(e) {
                            logoPreviewContainer.innerHTML = '<img id="logo-preview-img" src="' + e.target.result + '" alt="Logo Preview" style="display: block; max-width: 120px; max-height: 120px;"><span id=\'remove-logo-btn\' style=\'position: absolute; top: 0; right: 0; background: #fff; border: 2px solid #e53e3e; color: #e53e3e; font-size: 32px; cursor: pointer; border-radius: 50%; width: 36px; height: 36px; line-height: 32px; text-align: center; display: flex; align-items: center; justify-content: center; z-index: 9999;\'>&times;</span>';
                            logoPreviewContainer.style.display = 'inline-block';
                            logoUploadWrapper.style.display = 'none';
                            addRemoveBtnListener();
                        }
                        reader.readAsDataURL(fileInput.files[0]);
                    }
                });
            }
        });
        </script>

        <div style="text-align: center; margin-top: 30px;">
            <button type="submit" class="btn btn-success">
                <i class="fas fa-{{ 'save' if card else 'plus' }}"></i> 
                {{ 'Update Card' if card else 'Generate Card' }}
            </button>
        </div>
    </form>

    <div class="nav-links">
        <a href="{{ url_for('dashboard') }}" class="btn btn-outline">
            <i class="fas fa-arrow-left"></i> Back to Dashboard
        </a>
        <a href="{{ url_for('dashboard') }}" class="btn btn-outline">
            <i class="fas fa-home"></i> Home
        </a>
    </div>
</div>
{% endblock %}
